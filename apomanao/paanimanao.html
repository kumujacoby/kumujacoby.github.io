<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="HandheldFriendly" content="true">
    <title>PƒÅ ªani Mana ªo</title>
    <style>
        /* Base Variables - Using Kamehameha Colors */
        :root {
            --navy: #1E3057;
            --royal-blue: #5480E8;
            --white: #FFFFFF;
            --light-gray: #F0F0F0;
            --dark-teal: #3A5350;
            --teal: #40816E;
            --brown: #906841;
            --gold: #C79756;
            --rust: #A64331;
            --terra-cotta: #C64F3A;
            --burgundy: #5C1A2D;
            --rose: #833043;
            
            /* Grid Units */
            --grid-base: 8px;
            --grid-2x: 16px;
            --grid-3x: 24px;
            --grid-4x: 32px;
            --grid-5x: 40px;
            --grid-6x: 48px;
            --grid-8x: 64px;
            --grid-10x: 80px;
            --grid-12x: 96px;
            
            /* Typography Scale */
            --text-xs: 14px;
            --text-sm: 16px;
            --text-md: 20px;
            --text-lg: 24px;
            --text-xl: 32px;
            --text-2xl: 42px;
            --text-3xl: 56px;
            --text-4xl: 72px;
            
            /* Line Heights */
            --leading-tight: 1.1;
            --leading-normal: 1.3;
            --leading-relaxed: 1.5;
        }
        
        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        html, body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: var(--text-sm);
            line-height: var(--leading-normal);
            color: var(--navy);
            background-color: var(--navy);
            overflow-x: hidden;
            height: 100%;
            width: 100%;
        }
        
        /* Layout Container */
        .container {
            max-width: 900px; /* Reduced from 1024px */
            margin: 0 auto;
            padding: 0 var(--grid-2x);
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - var(--grid-6x));
        }
        
        .main-container {
            width: 100%;
            background-color: var(--white);
            border-radius: var(--grid-3x);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            flex: 1;
            margin: var(--grid-2x) 0;
        }
        
        /* Header */
        .header {
            background-color: var(--gold);
            color: var(--white);
            padding: 0;
            text-align: center;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 100;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .header h1 {
            font-family: 'Helvetica Neue', sans-serif;
            font-size: 36px;
            letter-spacing: -0.02em;
            margin: 0;
            line-height: 1.1;
        }
        
        .nav-arrow {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            color: var(--white);
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 0 24px;
            transition: background-color 0.2s;
            border-right: 1px solid white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .nav-arrow:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Content area - Using flex to distribute space */
        .content {
            padding: var(--grid-2x);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent scrolling */
        }
        
        /* Game Stats and Controls */
        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--grid-base);
            margin-bottom: var(--grid-base);
            align-items: center; /* Keep this to ensure vertical alignment */
        }
        
        .score-display, .timer-display {
            margin-top: 0; /* Remove top margin */
            background-color: var(--light-gray);
            padding: var(--grid-base);
            border-radius: var(--grid-base);
            font-weight: bold;
            font-size: var(--text-md);
            text-align: center;
        }
        
        .score-display {
            color: var(--teal);
        }
        
        .timer-display {
            color: var(--navy);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--grid-base);
            margin-bottom: var(--grid-base);
        }
        
        .control-btn {
            margin-top: var(--grid-base);
            padding: var(--grid-base);
            border: none;
            border-radius: var(--grid-base);
            cursor: pointer;
            font-size: var(--text-sm);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease, transform 0.2s;
        }
        
        .control-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        #new-game-btn {
            background-color: var(--royal-blue);
            color: var(--white);
            grid-column: 2; /* Center column */
            margin: 0; /* Remove vertical margin */
            width: 100%; /* Take full width of grid cell */
        }
        #new-game-btn:hover {
            background-color: var(--navy);
        }
        
        #level-easy-btn {
            background-color: var(--teal);
            color: var(--white);
        }
        #level-easy-btn:hover {
            background-color: var(--dark-teal);
        }
        
        #level-medium-btn {
            background-color: var(--gold);
            color: var(--white);
        }
        #level-medium-btn:hover {
            background-color: var(--brown);
        }
        
        #level-hard-btn {
            background-color: var(--rust);
            color: var(--white);
        }
        #level-hard-btn:hover {
            background-color: var(--terra-cotta);
        }
        
        .active-level {
            border: 3px solid var(--navy);
            transform: scale(1.05);
        }
        
        .button-emoji {
            font-size: var(--text-md);
            margin-right: var(--grid-base);
        }
        
        /* Game Board - Using flex-grow to take up available space */
        .game-board-container {
            margin-top: var(--grid-4x); /* Reduced from var(--grid-8x) */
            flex: 1; /* Take remaining space */
            overflow: visible; /* Change from hidden to visible */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Add this to center vertically */
            padding: var(--grid-2x); /* Add padding to prevent cutoff */
        }
        
        .game-board {
            display: grid;
            gap: 1vh; /* Responsive gap */
            width: 100%;
            height: 100%; /* Take all available height */
            place-content: center; /* Center cards in the container */
            position: relative; /* Add this */
            z-index: 1; /* Add this to ensure cards appear above other elements */
        }
        
        .card {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            cursor: pointer;
            width: 100%;
            height: 100%;
            z-index: 2; /* Add this to ensure animations are visible */
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--grid-base);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .card-front {
            color: var(--white);
            background-color: var(--royal-blue);
            transform: rotateY(180deg);
            flex-direction: column;
            justify-content: center;
            padding: var(--grid-base);
            text-align: center;
        }
        
        .card-back {
            background-color: var(--navy);
            color: var (--white);
            font-size: 3.5vh; /* Responsive font size */
        }
        
        /* Card content styling - Responsive font sizes */
        .hawaiian-text {
            font-size: 3vh; /* Responsive text size */
            margin-bottom: 0.5vh;
            word-break: break-word;
            line-height: 1.1;
        }
        
        .emoji {
            font-size: 5vh; /* Responsive emoji size */
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--white);
            padding: var(--grid-4x);
            border-radius: var(--grid-2x);
            max-width: 80%;
            text-align: center;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: var(--grid-2x);
            right: var(--grid-2x);
            font-size: var(--text-xl);
            cursor: pointer;
        }
        
        .modal h2 {
            margin-bottom: var(--grid-2x);
            color: var(--navy);
        }
        
        .modal p {
            margin-bottom: var(--grid-3x);
        }
        
        .modal-btn {
            background-color: var(--royal-blue);
            color: var (--white);
            border: none;
            padding: var(--grid-2x) var(--grid-4x);
            border-radius: var(--grid-base);
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .modal-btn:hover {
            background-color: var(--navy);
        }
        
        /* Responsive adaptations */
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--grid-base);
            }
            
            .header h1 {
                font-size: var(--text-lg);
            }
            
            .game-stats {
                flex-direction: row;
                gap: var(--grid-base);
            }
            
            .score-display, .timer-display {
                font-size: var(--text-sm);
                padding: 4px;
                min-width: 0;
                flex: 1;
            }
            
            .button-text {
                display: none;
            }
            
            .button-emoji {
                margin-right: 0;
                font-size: var(--text-md);
            }
            
            .hawaiian-text {
                font-size: 2.7vh;
            }
            
            .emoji {
                font-size: 5vh;
            }
        }
        
        @media (max-width: 480px) {
            .main-container {
                border-radius: var(--grid-base);
                margin: var(--grid-base) 0;
            }
            
            .content {
                padding: var(--grid-base);
            }
            
            .controls {
                gap: 4px;
            }
            
            .control-btn {
                padding: 6px 4px;
            }
            
            .hawaiian-text {
                font-size: 2.5vh;
                margin-bottom: 2px;
            }
            
            .emoji {
                font-size: 4vh;
            }
        }
        
        /* Add more specific media query for laptops */
        @media (max-height: 800px) {
            .game-board-container {
                margin-top: var(--grid-2x);
            }
            
            .content {
                padding: var(--grid-base);
            }
            
            .game-stats {
                margin-bottom: var(--grid-base);
            }
            
            .controls {
                margin-bottom: var(--grid-base);
            }
            
            .control-btn {
                margin-top: var(--grid-base);
                padding: var(--grid-base) var(--grid-2x);
            }
        }
        
        /* Animation for card match */
        @keyframes cardMatch {
            0%, 100% { 
                transform: rotateY(180deg) scale(1);
                z-index: 3;
            }
            50% { 
                transform: rotateY(180deg) scale(1.1);
                z-index: 3;
            }
        }
        
        .card.matched .card-front {
            background-color: var(--teal);
            animation: cardMatch 0.5s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <div class="header">
                <a href="index.html" class="nav-arrow" aria-label="Return to main menu">
                    ‚Üê
                </a>
                <h1>PƒÅ ªani Mana ªo</h1>
            </div>
            
            <div class="content">
                <!-- Game Stats -->
                <div class="game-stats">
                    <div class="score-display">Score: <span id="score">0</span></div>
                    <button id="new-game-btn" class="control-btn">
                        <span class="button-emoji">üîÑ</span>
                        <span class="button-text">PƒÄ ªANI HOU</span>
                    </button>
                    <div class="timer-display">Time: <span id="timer">0:00</span></div>
                </div>
                
                <!-- Controls -->
                <div class="controls">
                    <button id="level-easy-btn" class="control-btn active-level">
                        <span class="button-emoji">üå±</span>
                        <span class="button-text">MA ªALAHI</span>
                    </button>
                    <button id="level-medium-btn" class="control-btn">
                        <span class="button-emoji">üåø</span>
                        <span class="button-text">WAENA</span>
                    </button>
                    <button id="level-hard-btn" class="control-btn">
                        <span class="button-emoji">üå¥</span>
                        <span class="button-text">PA ªAKIKƒ™</span>
                    </button>
                </div>
                
                <!-- Game Board Container -->
                <div class="game-board-container">
                    <!-- Game Board -->
                    <div id="game-board" class="game-board">
                        <!-- Cards will be generated here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Win Modal -->
    <div id="win-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>‚ú®Ho ªomaika ªi!‚ú®</h2>
            <p>Ua pau ka pƒÅ ªani i ke <span id="win-time">0:00</span></p>
            <p>Score: <span id="win-score">0</span></p>
            <button class="modal-btn" id="play-again-btn">PƒÄ ªANI HOU</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // Game elements
    const gameBoard = document.getElementById('game-board');
    const scoreElement = document.getElementById('score');
    const timerElement = document.getElementById('timer');
    const newGameBtn = document.getElementById('new-game-btn');
    const levelEasyBtn = document.getElementById('level-easy-btn');
    const levelMediumBtn = document.getElementById('level-medium-btn');
    const levelHardBtn = document.getElementById('level-hard-btn');
    const winModal = document.getElementById('win-modal');
    const winTimeElement = document.getElementById('win-time');
    const winScoreElement = document.getElementById('win-score');
    const playAgainBtn = document.getElementById('play-again-btn');
    const modalClose = document.querySelector('.modal-close');
    
    // Game state
    let score = 0;
    let timer = 0;
    let timerInterval;
    let flippedCards = [];
    let matchedPairs = 0;
    let totalPairs = 0;
    let lockBoard = false;
    let gameStarted = false;
    let difficulty = 'easy'; // Default difficulty
    
    // Word pairs by difficulty with emojis
    const wordPairs = {
        easy: [
            { hawaiian: "wai", emoji: "üíß" },
            { hawaiian: "kai", emoji: "üåä" },
            { hawaiian: "pua", emoji: "üå∫" },
            { hawaiian: "hale", emoji: "üè†" },
            { hawaiian: "i ªa", emoji: "üêü" },
            { hawaiian: " ªƒ´lio", emoji: "üêï" },
            { hawaiian: "p≈çpoki", emoji: "üê±" },
            { hawaiian: "manu", emoji: "üê¶" },
            { hawaiian: "p≈ç", emoji: "üåô" },
            { hawaiian: "lƒÅ", emoji: "‚òÄÔ∏è" },
            { hawaiian: " ªekahi", emoji: "1Ô∏è‚É£" },
            { hawaiian: " ªelua", emoji: "2Ô∏è‚É£" },
            { hawaiian: " ªekolu", emoji: "3Ô∏è‚É£" },
            { hawaiian: " ªehƒÅ", emoji: "4Ô∏è‚É£" },
            { hawaiian: " ªelima", emoji: "5Ô∏è‚É£" },
            { hawaiian: " ªeono", emoji: "6Ô∏è‚É£" },
            { hawaiian: " ªehiku", emoji: "7Ô∏è‚É£" },
            { hawaiian: " ªewalu", emoji: "8Ô∏è‚É£" },
            { hawaiian: " ªeiwa", emoji: "9Ô∏è‚É£" },
            { hawaiian: " ªumi", emoji: "üîü" }
        ],
        medium: [
            { hawaiian: "aloha", emoji: "üíï" },
            { hawaiian: "mahalo", emoji: "üôèüèΩ" },
            { hawaiian: "wahine", emoji: "üë©üèΩ" },
            { hawaiian: "kƒÅne", emoji: "üë®üèΩ‚Äçü¶±" },
            { hawaiian: "keiki", emoji: "üë∂üèΩ" },
            { hawaiian: "makua", emoji: "üë™" },
            { hawaiian: "kumu", emoji: "üßëüèΩ‚Äçüè´" },
            { hawaiian: "haumƒÅna", emoji: "üßëüèΩ‚Äçüéì" },
            { hawaiian: " ªohana", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { hawaiian: "hoaloha", emoji: "ü§ùüèΩ" }
        ],
        hard: [
            { hawaiian: "ho ªomaika ªi", emoji: "üéâ" },
            { hawaiian: "mahi ªai", emoji: "üßëüèΩ‚Äçüåæ" },
            { hawaiian: "lawelawe", emoji: "üõéÔ∏è" },
            { hawaiian: "ku ªupau", emoji: "üí™üèΩ" },
            { hawaiian: "pa ªahana", emoji: "üë∑üèΩ" },
            { hawaiian: "lokomaika ªi", emoji: "ü§≤üèΩ" },
            { hawaiian: "ho ªomanawanui", emoji: "‚è≥" },
            { hawaiian: "h≈ç ªike ªike", emoji: "üé≠" },
            { hawaiian: "k≈´ ªoko ªa", emoji: "ü¶Ö" },
            { hawaiian: "ho ªomaopopo", emoji: "üß†" }
        ]
    };
    
    // Functions
    function updateScore(value) {
        score = value;
        scoreElement.textContent = score;
        winScoreElement.textContent = score;
    }
    
    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timer = 0;
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            timer++;
            updateTimerDisplay();
        }, 1000);
    }
    
    function stopTimer() {
        clearInterval(timerInterval);
    }
    
    function updateTimerDisplay() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        winTimeElement.textContent = timerElement.textContent;
    }
    
    function resetGame() {
    stopTimer();
    timer = 0;
    updateTimerDisplay();
    updateScore(0);
    matchedPairs = 0;
    totalPairs = 0;  // Add this line
    gameBoard.innerHTML = '';
    flippedCards = [];
    lockBoard = false;
    gameStarted = false;
}
    
    function startNewGame() {
        resetGame();
        // Get word pairs based on difficulty
        const pairsNeeded = getNumberOfPairs();
        
        // Set totalPairs for win condition
        totalPairs = pairsNeeded;  // Add this line

        // Randomly select pairs instead of taking the first N
        const shuffledPairs = shuffleArray([...wordPairs[difficulty]]);
        const currentWordPairs = shuffledPairs.slice(0, pairsNeeded);   
        
        // Create pairs of cards for each word
        const cardPairs = createCardPairs(currentWordPairs);
        
        // Shuffle the cards
        const shuffledCards = shuffleArray(cardPairs);
        
        // Create and append card elements
        createCardElements(shuffledCards);
        
        // Adjust grid layout based on difficulty
        adjustGridLayout();
    }
    
    function getNumberOfPairs() {
        switch (difficulty) {
            case 'easy': return 10;  // 20 cards total (10 pairs)
            case 'medium': return 10;  // 20 cards total (10 pairs)
            case 'hard': return 10;  // 20 cards total (10 pairs)
            default: return 10;
        }
    }
    
    function createCardPairs(words) {
        let pairs = [];
        
        words.forEach(word => {
            // Hawaiian card
            pairs.push({
                type: 'hawaiian',
                text: word.hawaiian,
                match: word.emoji
            });
            
            // Emoji card
            pairs.push({
                type: 'emoji',
                text: word.emoji,
                match: word.hawaiian
            });
        });
        
        return pairs;
    }
    
    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }
    
    function createCardElements(cards) {
        gameBoard.innerHTML = ''; // Clear board
        
        cards.forEach((card, index) => {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            cardElement.dataset.index = index;
            cardElement.dataset.type = card.type;
            cardElement.dataset.text = card.text;
            cardElement.dataset.match = card.match;
            
            // Create card front
            const cardFront = document.createElement('div');
            cardFront.className = 'card-front';
            
            // Create appropriate text container based on card type
            if (card.type === 'hawaiian') {
                const hawaiianText = document.createElement('div');
                hawaiianText.className = 'hawaiian-text';
                hawaiianText.textContent = card.text;
                cardFront.appendChild(hawaiianText);
            } else {
                const emojiContainer = document.createElement('div');
                emojiContainer.className = 'emoji';
                emojiContainer.textContent = card.text;
                cardFront.appendChild(emojiContainer);
            }
            
            // Create card back
            const cardBack = document.createElement('div');
            cardBack.className = 'card-back';
            cardBack.innerHTML = '?';
            
            // Assemble the card
            cardElement.appendChild(cardFront);
            cardElement.appendChild(cardBack);
            
            // Add click event
            cardElement.addEventListener('click', flipCard);
            
            // Add to game board
            gameBoard.appendChild(cardElement);
        });
    }
    
    function adjustGridLayout() {
    const container = document.querySelector('.game-board-container');
    const containerHeight = container.clientHeight;
    const containerWidth = container.clientWidth;
    
    let cols = 5;
    let rows = 4;
    
    // Set grid layout
    gameBoard.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    gameBoard.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    
    // Calculate the optimal card size based on available space
    const gap = 8; // Fixed gap size
    const maxCardWidth = 140; // Maximum card width for better readability
    
    const cardWidth = Math.min(
        maxCardWidth,
        Math.floor((containerWidth - (cols - 1) * gap) / cols)
    );
    const cardHeight = Math.floor((containerHeight - (rows - 1) * gap) / rows);
    
    // Choose the smaller dimension to maintain aspect ratio
    const cardSize = Math.min(cardWidth, cardHeight);
    
    // Apply sizing to grid
    const totalWidth = cols * cardSize + (cols - 1) * gap;
    const totalHeight = rows * cardSize + (rows - 1) * gap;
    
    gameBoard.style.width = `${totalWidth}px`;
    gameBoard.style.height = `${totalHeight}px`;
    gameBoard.style.gap = `${gap}px`;
    gameBoard.style.margin = '0 auto';
    
    // Update font sizes based on card size
    const hawaiianTextSize = Math.max(16, Math.floor(cardSize * 0.25));
    const emojiSize = Math.max(24, Math.floor(cardSize * 0.4));
    
    document.documentElement.style.setProperty('--card-size', `${cardSize}px`);
    document.querySelectorAll('.hawaiian-text').forEach(el => {
        el.style.fontSize = `${hawaiianTextSize}px`;
    });
    document.querySelectorAll('.emoji').forEach(el => {
        el.style.fontSize = `${emojiSize}px`;
    });
}
    
    function flipCard() {
        if (lockBoard) return;
        if (this === flippedCards[0]) return;
        if (this.classList.contains('matched')) return;
        
        // Start the timer on first card flip
        if (!gameStarted) {
            gameStarted = true;
            startTimer();
        }
        
        this.classList.add('flipped');
        
        flippedCards.push(this);
        
        if (flippedCards.length === 2) {
            checkForMatch();
        }
    }
    
    function checkForMatch() {
        lockBoard = true;
        
        const card1 = flippedCards[0];
        const card2 = flippedCards[1];
        
        // Check if cards match
        const isMatch = (card1.dataset.text === card2.dataset.match) || 
                       (card2.dataset.text === card1.dataset.match);
        
        if (isMatch) {
            // It's a match
            setTimeout(() => {
                card1.classList.add('matched');
                card2.classList.add('matched');
                
                // Update score
                updateScore(score + 10);
                
                // Increase matched pairs count
                matchedPairs++;
                
                // Check if all pairs are matched
                if (matchedPairs === totalPairs) {
                    gameComplete();
                }
                
                resetTurn();
            }, 500);
        } else {
            // Not a match
            setTimeout(() => {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
                
                // Decrease score (but not below 0)
                updateScore(Math.max(0, score - 2));
                
                resetTurn();
            }, 1000);
        }
    }
    
    function resetTurn() {
        flippedCards = [];
        lockBoard = false;
    }
    
    function gameComplete() {
        stopTimer();
        // Show win modal after a slight delay
        setTimeout(() => {
            winModal.style.display = 'flex';
        }, 500);
    }
    
    function setDifficulty(level) {
        difficulty = level;
        
        // Update UI
        levelEasyBtn.classList.remove('active-level');
        levelMediumBtn.classList.remove('active-level');
        levelHardBtn.classList.remove('active-level');
        
        switch (level) {
            case 'easy':
                levelEasyBtn.classList.add('active-level');
                break;
            case 'medium':
                levelMediumBtn.classList.add('active-level');
                break;
            case 'hard':
                levelHardBtn.classList.add('active-level');
                break;
        }
        
        // Start a new game with the selected difficulty
        startNewGame();
    }
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (gameBoard.children.length > 0) {
            adjustGridLayout();
        }
    });
    
    // Event Listeners
    newGameBtn.addEventListener('click', () => startNewGame());
    
    levelEasyBtn.addEventListener('click', () => setDifficulty('easy'));
    levelMediumBtn.addEventListener('click', () => setDifficulty('medium'));
    levelHardBtn.addEventListener('click', () => setDifficulty('hard'));
    
    playAgainBtn.addEventListener('click', () => {
        winModal.style.display = 'none';
        startNewGame();
    });
    
    modalClose.addEventListener('click', () => {
        winModal.style.display = 'none';
    });
    
    // Close modal when clicking outside the content
    winModal.addEventListener('click', (e) => {
        if (e.target === winModal) {
            winModal.style.display = 'none';
        }
    });
    
    // Initialize the game
    startNewGame();
    
    // Adjust layout on first load (important!)
    window.addEventListener('load', function() {
        setTimeout(adjustGridLayout, 100); // Small delay to ensure DOM is ready
    });
});
    </script>
</body>
</html>